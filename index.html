<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Checklist de Inspe√ß√£o de Ferramentas ‚Äì Dep√≥sito</title>
<style>
:root {
  --bg: #121417;
  --card: #1c1f23;
  --accent: #2eb872;
  --muted: #a0a8b3;
  --border: #2a2f34;
  --text: #e9edf1;
  --input-bg: #fff;
}

body {
  margin: 0;
  padding: 12px;
  font-family: "Segoe UI", Arial, sans-serif;
  background: var(--bg);
  color: var(--text);
}

.container {
  max-width: 1000px;
  margin: auto;
}

header {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  align-items: center;
  gap: 10px;
}

h1 {
  font-size: 22px;
  margin: 0;
}

.card {
  background: var(--card);
  border-radius: 14px;
  padding: 20px;
  margin-top: 16px;
  box-shadow: 0 6px 14px rgba(0, 0, 0, 0.3);
  border: 1px solid var(--border);
}

.row {
  display: flex;
  flex-wrap: wrap;
  gap: 12px;
}

.row > div {
  flex: 1;
  min-width: 220px;
}

label {
  display: block;
  font-size: 13px;
  color: var(--muted);
  margin-bottom: 4px;
  font-weight: 500;
}

input[type=text],
select,
textarea {
  width: 100%;
  padding: 8px;
  border-radius: 8px;
  border: 1px solid var(--border);
  font-size: 14px;
  background: var(--input-bg);
  color: #1e293b;
}

textarea {
  resize: vertical;
}

.items {
  margin-top: 16px;
}

.item {
  background: #1f2327;
  border-radius: 10px;
  padding: 12px;
  border: 1px solid var(--border);
  margin-bottom: 12px;
  transition: background 0.2s;
}

.item:hover {
  background: #24282d;
}

.item h3 {
  margin: 0 0 4px;
  font-size: 15px;
  color: var(--text);
}

.photos {
  display: flex;
  gap: 6px;
  margin-top: 4px;
}

.photos img {
  width: 65px;
  height: 65px;
  border-radius: 8px;
  object-fit: cover;
  border: 1px solid var(--border);
}

.btn {
  display: inline-block;
  padding: 8px 16px;
  border-radius: 8px;
  border: none;
  cursor: pointer;
  font-weight: 600;
  font-size: 14px;
  transition: background 0.2s, transform 0.1s;
}

.btn:hover {
  transform: translateY(-1px);
}

.btn.primary {
  background: var(--accent);
  color: #fff;
}

.btn.primary:hover {
  background: #239e61;
}

.btn.ghost {
  background: transparent;
  border: 1px solid var(--accent);
  color: var(--accent);
}

.btn.ghost:hover {
  background: rgba(46, 184, 114, 0.1);
}

footer {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  justify-content: flex-end;
  margin-top: 20px;
}



@media (max-width: 600px) {
  .btn {
    width: 100%;
    text-align: center;
  }
}

</style>
</head>
<body>
<div class="container">
<header>
  <h1>Checklist de Inspe√ß√£o de Ferramentas</h1>
</header>
<div class="card">
  <div class="row">
    <div><label>Dep√≥sito</label>
      <select id="deposit"><option value="">Selecione um dep√≥sito</option></select>
    </div>
  </div>

  <div class="items" id="itemsContainer"></div>
  <p id="emptyNote" style="display:none;color:#777;text-align:center;">Nenhuma ferramenta para este dep√≥sito.</p>

  <div class="row" style="margin-top:12px;">
    <div><label>Observa√ß√£o Geral</label><textarea id="generalObs" rows="2"></textarea></div>
  </div>


  <footer>
    <button class="btn primary" id="reportBtn">Gerar PDF</button>
  </footer>
</div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2/jspdf.plugin.autotable.min.js"></script>

<script>
const { jsPDF } = window.jspdf;



// Textos explicativos aprimorados
const itemDescriptions = {
  "Tesoura": "Verificar se as l√¢minas est√£o afiadas, alinhadas, limpas e livres de ferrugem. Checar se o cabo est√° firme e confort√°vel ao uso.",
  "Tesoura de Corte": "Inspecionar o alinhamento e a afia√ß√£o das l√¢minas, aus√™ncia de oxida√ß√£o, firmeza do cabo e funcionamento suave ao abrir e fechar.",
  "Trena": "Inspecionar a fixa√ß√£o da cabe√ßa, aus√™ncia de folgas, rachaduras ou oxida√ß√£o. Checar se o cabo est√° √≠ntegro e bem fixado.",
  "Escova de A√ßo": "Checar se as cerdas est√£o firmes, sem desgaste excessivo ou deforma√ß√µes, e se o cabo est√° em bom estado e firme.",
  "Martelo": "Inspecionar a fixa√ß√£o da cabe√ßa, aus√™ncia de folgas, rachaduras ou oxida√ß√£o. Checar se o cabo est√° √≠ntegro e bem fixado.",
  "Estilete": "Verificar se a l√¢mina est√° afiada e firme no suporte, funcionamento da trava, e se o corpo do estilete n√£o possui trincas.",
  "Kit Cinta Arqueamento": "Conferir se todas as pe√ßas do kit est√£o presentes, limpas e funcionais, com mecanismo de arqueamento operando corretamente.",
  "Chave Combinada": "Inspecionar se n√£o h√° desgaste nas bocas, deforma√ß√µes ou oxida√ß√£o. Verificar se a ferramenta est√° limpa e em bom estado.",
  "Alicate Universal": "Verificar o alinhamento das mand√≠bulas, movimento suave sem folgas, e integridade dos cabos isolantes.",
  "Chave de Fenda": "Checar se a ponta est√° √≠ntegra, sem desgaste ou deforma√ß√£o, e se o cabo est√° firme e sem rachaduras.",
  "P√©-de-Cabra Torcido": "Inspecionar se n√£o h√° trincas, empenamentos ou deforma√ß√µes. Verificar se a superf√≠cie est√° limpa e sem corros√£o.",
  "Marreta": "Verificar se a cabe√ßa est√° firme e sem folgas, cabo √≠ntegro e sem rachaduras, e aus√™ncia de oxida√ß√£o nas partes met√°licas.",
  "Ferramento": "Avaliar o estado geral da ferramenta, funcionamento adequado, limpeza e aus√™ncia de danos estruturais.",
  "Hands Off": "Checar se o equipamento est√° limpo, sem rachaduras ou deforma√ß√µes, e se os mecanismos est√£o operando corretamente.",
  "Alicate Corta Cabo": "Verificar o corte eficiente sem deformar o cabo, alinhamento das l√¢minas e integridade do isolamento.",
  "Grampeador": "Testar o funcionamento suave, verificar se n√£o emperra e se realiza grampeamento completo e firme.",
  "Torque Armador 12": "Conferir a calibra√ß√£o do torque, aus√™ncia de folgas, funcionamento preciso e integridade estrutural.",
  "Esquadro 10 para Carpinteiro": "Verificar se mant√©m √¢ngulos precisos de 90¬∞, sem empeno, rachaduras ou sujeira excessiva.",
  "L√°pis Carpinteiro": "Checar se escreve corretamente, ponta afiada e corpo sem quebras ou rachaduras.",
  "Form√£o para Madeira": "Verificar se a l√¢mina est√° afiada, limpa e bem fixada ao cabo, sem oxida√ß√£o ou folgas.",
  "Kit de Chave Combinada": "Confirmar se o conjunto est√° completo, limpo, sem deforma√ß√µes e armazenado adequadamente.",
  "Serra Tico e Teco": "Inspecionar se a l√¢mina est√° firme, afiada e sem desgaste, e se o motor e acionamento funcionam corretamente.",
  "Jogo de Brocas e Soquetes": "Verificar se o kit est√° completo, organizado, sem desgaste nas pontas e com encaixes firmes.",
  "Parafusadeira El√©trica": "Testar o funcionamento, rota√ß√£o e torque, conferir integridade da carca√ßa e n√≠vel de carga da bateria.",
  "L√¢mina de Serra Tico-Teco": "Verificar se est√° afiada, limpa, sem empenamento ou trincas e pronta para uso seguro.",
  "P√© de Cabra": "Verificar Sem trincas ou rachaduras, sem deforma√ß√µes, sem desgaste excerssivo.",
  "Chave inglesa": "Sem rachaduras ou trincas, Sem desgaste excessivo.",
  "Chave de Boca": "Sem desgaste ou arredondamento, Sem trincas ou fissuras, Sem fissuras ou deforma√ß√µes.",
  "Chave de Corrente Para Tubos": "Sem elos quebrados ou trincados,Sem desgaste excessivo, Tens√£o correta.",

};


// Itens por dep√≥sito
const itemsByDeposit = {
  "Carpintaria": [
    "Chave de Fenda", "Alicate Universal", "Martelo", "Estilete", "Trena",
    "Torque Armador 12", "Esquadro 10 para Carpinteiro", "L√°pis Carpinteiro",
    "Form√£o para Madeira", "Kit de Chave Combinada", "Serra Tico e Teco",
    "Jogo de Brocas e Soquetes", "Parafusadeira El√©trica", "L√¢mina de Serra Tico-Teco"
  ],

  "Dep√≥sito 6": [
    "Kit Cinta Arqueamento"
  ],

  "Dep√≥sito 9": [
    "Trena", "Escova de A√ßo", "Martelo", "Estilete", "Tesoura", "Kit Cinta Arqueamento"
  ],

  "Dep√≥sito 13": [
    "Tesoura de Corte", "Chave Combinada", "Trena", "Alicate Universal",
    "Chave de Fenda", "Martelo", "Estilete", "P√©-de-Cabra Torcido", "Marreta",
    "Ferramento", "Hands Off"
  ],

  "Dep√≥sito 24": [
    "Trena", "P√© de Cabra Torcido", "Tesoura de Corte", "Alicate Corta Cabo",
    "Martelo", "Escova de A√ßo", "Chave de Fenda", "Kit Cinta Arqueamento"
  ],

  "Dep√≥sito 25": [
    "Chave de Fenda", "Alicate Universal", "Martelo", "Estilete",
    "P√© de Cabra Torcido", "Trena", "Kit Cinta Arqueamento", "Grampeador",
    "P√© de Cabra", "Chave inglesa", "Alicate de Corte", "Chave de Boca", "Chave de Corrente Para Tubos"
  ]
};


// Ordem personalizada para aparecer no PDF
const depositOrder = ["Carpintaria", "Dep√≥sito 9", "Dep√≥sito 13", "Dep√≥sito 24", "Dep√≥sito 25"];


// Preenche dep√≥sitos
const depositSelect=document.getElementById('deposit');
Object.keys(itemsByDeposit).forEach(dep=>{
  const opt=document.createElement('option'); opt.value=dep; opt.textContent=dep; depositSelect.appendChild(opt);
});

// Criar itens e fotos
const itemsContainer=document.getElementById('itemsContainer');
const emptyNote=document.getElementById('emptyNote');
let photosData = {};

depositSelect.addEventListener("change", () => {
  const deposit = depositSelect.value;
  const itemsContainer = document.getElementById("itemsContainer");
  itemsContainer.innerHTML = "";

  if (!deposit || !itemsByDeposit[deposit]) return;

  const list = itemsByDeposit[deposit];
  photosData[deposit] = [];

  list.forEach((item, i) => {
    const div = document.createElement("div");
    div.className = "item";
    const descricao = itemDescriptions[item] || "";

    div.innerHTML = `
      <h3>${i + 1}. ${item}</h3>
      <div style="font-size:13px; color:#bbb; margin-bottom:8px; text-align:left;">
        ${descricao}
      </div>
      <label><input type="radio" name="chk_${i}" value="Aprovada"> Aprovada</label>
      <label><input type="radio" name="chk_${i}" value="Reprovada"> Reprovada</label>
      <input type="text" placeholder="Observa√ß√£o">
     <div class="photos" id="photos_${i}">
  <!-- Bot√£o 1: C√¢mera -->
  <label class="btn ghost" style="padding:4px 8px;font-size:12px;">üì∑ Abrir C√¢mera
    <input type="file" accept="image/*" capture="environment" style="display:none"
           onchange="previewPhoto(event,'${deposit}',${i},0)">
  </label>

  <!-- Bot√£o 2: Galeria -->
  <label class="btn ghost" style="padding:4px 8px;font-size:12px;">üñºÔ∏è Selecionar da Galeria
    <input type="file" accept="image/*" style="display:none"
           onchange="previewPhoto(event,'${deposit}',${i},0)">
  </label>
</div>

    `;

    itemsContainer.appendChild(div);
    photosData[deposit][i] = [];
  });
});



window.previewPhoto = function(e, deposito, index, photoIndex){
  const cont = document.getElementById(`photos_${index}`);
  const file = e.target.files[0]; if(!file) return;
  const reader = new FileReader();
  reader.onload = function(ev){
    photosData[deposito][index][photoIndex] = ev.target.result;
    const img = document.createElement('img'); img.src = ev.target.result; cont.appendChild(img);
  }
  reader.readAsDataURL(file);
};



// Gerar PDF
document.getElementById("reportBtn").addEventListener("click", async () => {
  const doc = new jsPDF("p","pt","a4");
  const width = doc.internal.pageSize.getWidth();
  const margin = 40;
  let y = 60;



    // === PRIMEIRA P√ÅGINA: SUM√ÅRIO ===
  doc.setFont("helvetica", "bold");
  doc.setFontSize(16);
  doc.text("RELAT√ìRIO DE INSPE√á√ÉO DE FERRAMENTAS DO SOP/ARM", width / 2, y, { align: "center" });
  y += 30;

  doc.setFont("helvetica", "normal");
  doc.setFontSize(13);
  doc.text("SUM√ÅRIO", width / 2, y, { align: "center" });
  y += 30;

  const sumario = [
    "1. Cronograma de Inspe√ß√µes.................................................................2",
    "2. Rela√ß√£o de ferramentas do SOP/ARM.......................................................3",
    "3. Inspe√ß√£o Carpintaria....................................................................3",
    "4. Rela√ß√£o de Ferramentas Inaptas..........................................................6",
    "5. Inspe√ß√£o Dep√≥sito/D-09..................................................................7",
    "6. Rela√ß√£o de Ferramentas Inaptas..........................................................7",
    "7. Inspe√ß√£o Dep√≥sito/D-13..................................................................9",
    "8. Rela√ß√£o de Ferramentas Inaptas.........................................................10",
    "9. Inspe√ß√£o Dep√≥sito/D-24.................................................................12",
    "10. Rela√ß√£o de Ferramentas Inaptas........................................................12",
    "11. Inspe√ß√£o Dep√≥sito/D-25................................................................14",
    "12. Rela√ß√£o de Ferramentas Inaptas........................................................15",
    "13. Assinatura dos Participantes da Inspe√ß√£o..............................................17",
  ];

  doc.setFontSize(11);
  // === SUM√ÅRIO ALINHADO COM PONTOS ===
doc.setFont("helvetica", "normal");
doc.setFontSize(11);

const marginLeft = margin;
const pageCol = width - margin; // posi√ß√£o m√°xima da p√°gina

sumario.forEach(linha => {
  // Divide t√≠tulo e n√∫mero da p√°gina
  const lastDot = linha.lastIndexOf(".");
  const pagina = linha.slice(lastDot + 1).trim(); // n√∫mero da p√°gina
  const titulo = linha.slice(0, lastDot).trim(); // t√≠tulo sem os pontos

  // Largura do texto
  const larguraTitulo = doc.getTextWidth(titulo + " ");
  const larguraPagina = doc.getTextWidth(pagina);

  // Calcula quantos pontos cabem
  const pontosDisponiveis = pageCol - marginLeft - larguraTitulo - larguraPagina - 5;
  const nPontos = Math.floor(pontosDisponiveis / doc.getTextWidth("."));
  const pontos = ".".repeat(nPontos);

  // Escreve no PDF
  doc.text(`${titulo} ${pontos}${pagina}`, marginLeft, y);
  y += 18;
});




// Segunda p√°gina: Cronograma
// ---------------------
doc.addPage(); // for√ßa nova p√°gina
y = 60;

doc.setFontSize(12);
  // === SEGUNDA P√ÅGINA: CRONOGRAMA E RELA√á√ÉO DE FERRAMENTAS ===
  doc.setFont("helvetica", "bold");
  doc.setFontSize(14);
  doc.text("1. Cronograma de Inspe√ß√µes", margin, y);
  y += 20;

  doc.setFont("helvetica", "normal");
  doc.setFontSize(11);
  const cronogramaTexto =
    "1.1 ‚Äì O cronograma foi estabelecido considerando o per√≠odo de 12 meses. " +
    "O uso desta ferramenta ajuda a evitar atrasos nas inspe√ß√µes e a garantir que a atividade seja entregue no prazo estipulado.";
  const linhas = doc.splitTextToSize(cronogramaTexto, width - margin * 2);
  doc.text(linhas, margin, y);
  y += 40;

  // === Tabela do Cronograma ===
  doc.setFont("helvetica", "bold");
  doc.text("Tabela 1 ‚Äì Cronograma de Inspe√ß√£o", margin, y);
  y += 20;

  doc.setFont("helvetica", "normal");
  const headers = ["Data da Inspe√ß√£o", "M√™s", "Status"];
  const rows = [
    ["27/01/2024", "Janeiro", "Conclu√≠da"],
    ["26/02/2024", "Fevereiro", "Conclu√≠da"],
    ["27/03/2024", "Mar√ßo", "Conclu√≠da"],
    ["26/04/2024", "Abril", "Conclu√≠da"],
    ["27/05/2024", "Maio", "Conclu√≠da"],
    ["26/06/2024", "Junho", "Conclu√≠da"],
    ["26/07/2024", "Julho", "Conclu√≠da"],
    ["26/08/2024", "Agosto", "Conclu√≠da"],
    ["25/09/2024", "Setembro", "Conclu√≠da"],
    ["25/10/2024", "Outubro", "Conclu√≠da"],
    ["25/11/2024", "Novembro", ""],
    ["27/12/2024", "Dezembro", ""],
  ];

  doc.autoTable({
  startY: y,
  head: [headers],
  body: rows,
  theme: "grid",
  headStyles: { fillColor: [46, 184, 114], textColor: 255 },
  styles: { fontSize: 10, cellPadding: 4 },
  margin: { left: margin, right: margin },
  didDrawCell: function(data) {
    // Desenhar quadrado do tamanho da c√©lula na coluna "Data da Inspe√ß√£o"
    if(data.column.index === 0 && data.section === 'body') {
      const month = data.row.raw[1].trim(); // pega o m√™s da linha
      const colors = {
        "Janeiro": [46, 184, 114],
        "Fevereiro": [0, 128, 0],
        "Mar√ßo": [0, 0, 255],
        "Abril": [128, 0, 128],
        "Maio": [165, 42, 42],
        "Junho": [0, 0, 139],
        "Julho": [144, 238, 144],
        "Agosto": [255, 165, 0],
        "Setembro": [169, 169, 169],
        "Outubro": [216, 191, 216],
        "Novembro": [173, 216, 230],
        "Dezembro": [255, 215, 0]
      };
      if(colors[month]){
        const x = data.cell.x;
        const y = data.cell.y;
        const w = data.cell.width;
        const h = data.cell.height;
        doc.setFillColor(...colors[month]);
        doc.rect(x, y, w, h, 'F'); // ret√¢ngulo do tamanho da c√©lula
      }
    }
  }
});


  y = doc.lastAutoTable.finalY + 30;

  // === Se√ß√£o 2 ===
  doc.setFont("helvetica", "bold");
  doc.setFontSize(14);
  doc.text("2. Rela√ß√£o de Ferramentas do SOP/ARM", margin, y);
  y += 20;

  doc.setFont("helvetica", "normal");
  const relacaoTexto =
    "2.1 ‚Äì As ferramentas utilizadas pela equipe do SOP/ARM buscam garantir a melhoria " +
    "na qualidade do trabalho e, principalmente, a seguran√ßa das pessoas que as utilizam. " +
    "At√© o momento da elabora√ß√£o deste relat√≥rio o SOP/ARM disp√µe de 21 modelos de ferramentas " +
    "distribu√≠das entre os dep√≥sitos sob nossa gest√£o.";
  const linhas2 = doc.splitTextToSize(relacaoTexto, width - margin * 2);
  doc.text(linhas2, margin, y);
  y += 40;

// === TERCEIRA P√ÅGINA: Rela√ß√£o de Ferramentas x Quantidade + Inspe√ß√£o Carpintaria ===
doc.addPage();
y = 60;

// T√≠tulo da tabela
doc.setFont("helvetica","bold");
doc.setFontSize(14);
doc.text("2. Tabela 2 ‚Äì Rela√ß√£o de Ferramentas x Quantidade", margin, y);
y += 25;

// Dados da tabela
const ferramentasData = [
  ["Alicate Universal", 8],
  ["Chave de Fenda", 28],
  ["Martelo", 8],
  ["Estilete", 8],
  ["Trena", 8],
  ["Torque Armador 12", 2],
  ["Esquadro", 2],
  ["L√°pis p/ Carpinteiro", 2],
  ["Form√£o p/ Madeira", 2],
  ["Serra Tico-Tico", 1],
  ["Kit de chave combinada", 1],
  ["Jogo de Brocas", 1],
  ["Parafusadeira", 1],
  ["L√¢mina de Serra Tico-Tico", 1],
  ["Tesoura de Corte", 4],
  ["Chave Combinada", 4],
  ["Arco de Serra", 1],
  ["Escova de A√ßo", 3],
  ["Alicate Corta Cabo", 2],
  ["P√© de Cabra Torcido", 4],
  ["Marreta", 1]
];

doc.autoTable({
  startY: y,
  head: [["Ferramentas", "Quantidade"]],
  body: ferramentasData,
  theme: "grid",
  headStyles: { fillColor: [46, 184, 114], textColor: 255 },
  styles: { fontSize: 10, cellPadding: 4 },
  margin: { left: margin, right: margin }
});

y = doc.lastAutoTable.finalY + 30;

// Texto explicativo da Carpintaria
doc.setFont("helvetica","bold");
doc.setFontSize(14);
doc.text("3. Inspe√ß√£o das Ferramentas da Carpintaria", margin, y);
y += 20;

doc.setFont("helvetica","normal");
doc.setFontSize(11);
const textoCarpintaria =
  "3.1 ‚Äì A carpintaria do SOP/ARM √© uma √°rea destinada a execu√ß√£o de servi√ßos de confec√ß√£o de embalagens " +
  "para transporte de materiais, constru√ß√£o e/ou reparo em pallets, dentre outros servi√ßos que tenham a madeira como mat√©ria-prima.";

const linhasCarpintaria = doc.splitTextToSize(textoCarpintaria, width - margin*2);
doc.text(linhasCarpintaria, margin, y);
y += linhasCarpintaria.length * 12 + 20;

// === Continua√ß√£o da Carpintaria ===
doc.setFont("helvetica","normal");
doc.setFontSize(11);

const texto32 =
"3.2 ‚Äì Nesta √°rea, as atividades citadas no item 3.1 deste relat√≥rio de inspe√ß√£o s√£o realizadas por 02 colaboradores. " +
"Os profissionais est√£o aptos a manusear as ferramentas utilizadas na execu√ß√£o dos servi√ßos e respons√°veis pela limpeza, conserva√ß√£o e verifica√ß√£o di√°ria da condi√ß√£o das ferramentas.";
doc.text(doc.splitTextToSize(texto32, width - margin * 2), margin, y);
y += 60;

const texto33 =
"3.3 ‚Äì Atualmente a carpintaria possui 31 ferramentas, tais como: Parafusadeira, Jogo de brocas, martelos, alicates, serra, dentre outras.";
doc.text(doc.splitTextToSize(texto33, width - margin * 2), margin, y);
y += 40;

// Espa√ßo reservado para Imagem 1
doc.text("Imagem 1 ‚Äì Inspe√ß√£o das ferramentas utilizadas na carpintaria.", margin, y);
y += 180;

// Pr√≥ximos textos
const texto34 =
"3.4 ‚Äì A inspe√ß√£o das ferramentas √© realizada por equipe multidisciplinar formada por representantes do SOP/ARM e SMS. " +
"Nela, os usu√°rios das ferramentas foram convidados a participar, objetivando desenvolver ainda mais a percep√ß√£o de seguran√ßa quanto √† utiliza√ß√£o das ferramentas.";
doc.text(doc.splitTextToSize(texto34, width - margin * 2), margin, y);
y += 60;

const texto35 =
"3.5 ‚Äì Durante a atividade, a equipe respons√°vel pela inspe√ß√£o utiliza um checklist em que consta uma s√©rie de requisitos " +
"que precisam ser atendidos para que a ferramenta seja considerada apta para utiliza√ß√£o, conforme pode ser evidenciado na imagem 2.";
doc.text(doc.splitTextToSize(texto35, width - margin * 2), margin, y);
y += 40;

// Espa√ßo reservado para Imagem 2
doc.text("Imagem 2 ‚Äì Lista de verifica√ß√£o de conformidade das ferramentas.", margin, y);
y += 180;

const texto36 = "3.6 ‚Äì Rela√ß√£o de Ferramentas Inaptas";
doc.setFont("helvetica","bold");
doc.text(texto36, margin, y);
y += 25;

doc.setFont("helvetica","normal");
const texto37 =
"3.7 ‚Äì Durante a inspe√ß√£o das ferramentas ocorridas no dep√≥sito da Carpintaria, foi constatado que todas as ferramentas est√£o aptas para o servi√ßo.";
doc.text(doc.splitTextToSize(texto37, width - margin * 2), margin, y);
y += 50;


// Adicione a tabela aqui...

  const dataHora = new Date().toLocaleString("pt-BR");
  const depositos = Object.keys(itemsByDeposit);
  const obs = document.getElementById("generalObs").value || "‚Äî";

  for (let d = 0; d < depositos.length; d++) {
  const deposito = depositos[d];
  const itensDoDeposito = itemsByDeposit[deposito] || [];
  const obsDeposito = document.getElementById("generalObs").value || "";

  // Evita criar p√°gina vazia
  if (itensDoDeposito.length === 0 && obsDeposito.trim() === "") continue;

  // S√≥ adiciona nova p√°gina se n√£o for a primeira
  if (doc.internal.getNumberOfPages() > 1) doc.addPage();
  y = 60;



  // Cabe√ßalho: Data/Hora + Dep√≥sito
  const infos = [["Data/Hora", dataHora],["Dep√≥sito", deposito]];
  const boxHeightInfo = 22;
  const gapInfo = 10;
  const totalWidth = width - margin*2 - gapInfo*(infos.length-1);
  const boxWidth = totalWidth / infos.length;

  infos.forEach((info,i)=>{
    const x = margin + i*(boxWidth + gapInfo);
    doc.setFillColor(46,184,114);
    doc.roundedRect(x, y-16, boxWidth, boxHeightInfo, 5, 5, "F");
    doc.setTextColor(255,255,255);
    doc.setFont("helvetica","bold");
    doc.setFontSize(10);
    const text = `${info[0]}: ${info[1]}`;
    const textX = x + (boxWidth - doc.getTextWidth(text)) / 2;
    doc.text(text, textX, y);
    doc.setTextColor(0,0,0);
  });

  y += boxHeightInfo + 20;

  // Observa√ß√£o Geral
  doc.setFont("helvetica","bold");
  doc.setFontSize(12);
  doc.text("Observa√ß√£o Geral:",margin,y);
  y += 15;
  doc.setFont("helvetica","normal");
  const linesObs = doc.splitTextToSize(obs, width - margin*2);
  doc.text(linesObs, margin, y);
  y += linesObs.length*12 + 20;

  // Se for o Dep√≥sito 9, adiciona texto explicativo
if (deposito === "Dep√≥sito 9") {
  doc.setFont("helvetica", "bold");
  doc.setFontSize(14);
  doc.text("4. Inspe√ß√£o de Ferramentas Dep√≥sito D-09", margin, y);
  y += 25;

  doc.setFont("helvetica", "normal");
  doc.setFontSize(11);

  const texto41 = "4.1 ‚Äì O AL-09 do SOP/ARM √© um dep√≥sito destinado a recebimento, expedi√ß√£o e gest√£o de estoque.";
  const texto42 = "4.2 ‚Äì Nesta √°rea, as atividades citadas no item 4.1 deste relat√≥rio de inspe√ß√£o s√£o realizadas por 03 colaboradores. Os profissionais est√£o aptos a manusear as ferramentas utilizadas na execu√ß√£o dos servi√ßos e respons√°veis pela limpeza, conserva√ß√£o e verifica√ß√£o di√°ria da condi√ß√£o das ferramentas.";
  const texto43 = "4.3 ‚Äì Atualmente o AL-09 possui 03 ferramentas, tais como: Martelos, tesoura de corte, estilete.";
  const texto44 = "Imagem 3 ‚Äì Inspe√ß√£o das ferramentas utilizadas no AL-09.";
  const texto45 = "4.4 ‚Äì A inspe√ß√£o das ferramentas √© realizada por equipe multidisciplinar formada por representantes do SOP/ARM e SMS. Nela, os usu√°rios das ferramentas foram convidados a participar, objetivando desenvolver ainda mais a percep√ß√£o de seguran√ßa quanto √† utiliza√ß√£o das ferramentas.";
  const texto46 = "4.5 ‚Äì Durante a atividade, a equipe respons√°vel pela inspe√ß√£o utiliza um checklist em que consta uma s√©rie de requisitos que precisam ser atendidos para que a ferramenta seja considerada apta para utiliza√ß√£o, conforme pode ser evidenciado na imagem 4.";

  const paragrafos = [texto41, texto42, texto43, texto44, texto45, texto46];
  paragrafos.forEach(p => {
    const linhas = doc.splitTextToSize(p, width - margin * 2);
    doc.text(linhas, margin, y);
    y += linhas.length * 14 + 10;
  });

  y += 20; // espa√ßamento antes da lista de ferramentas
}


  // ... aqui continuam os itens normalmente
   doc.setFont("helvetica","normal"); const lines=doc.splitTextToSize(obs,width-margin*2); doc.text(lines,margin,y); y+=lines.length*12+20;

   // Texto espec√≠fico do Dep√≥sito 13
if (deposito === "Dep√≥sito 13") {
  doc.setFont("helvetica", "bold");
  doc.setFontSize(14);
  doc.text("5. Inspe√ß√£o de Ferramentas Dep√≥sito D-13", margin, y);
  y += 25;

  doc.setFont("helvetica", "normal");
  doc.setFontSize(11);

  const texto51 = "5.1 ‚Äì O AL-13 do SOP/ARM √© uma √°rea destinada √† execu√ß√£o de servi√ßos de confec√ß√£o de embalagens para transporte de materiais, constru√ß√£o e/ou reparo em pallets, dentre outros servi√ßos que tenham a madeira como mat√©ria-prima.";
  const texto52 = "5.2 ‚Äì Nesta √°rea, as atividades citadas no item 5.1 deste relat√≥rio de inspe√ß√£o s√£o realizadas por 13 colaboradores. Os profissionais est√£o aptos a manusear as ferramentas utilizadas na execu√ß√£o dos servi√ßos e respons√°veis pela limpeza, conserva√ß√£o e verifica√ß√£o di√°ria da condi√ß√£o das ferramentas.";
  const texto53 = "5.3 ‚Äì Atualmente o AL-13 possui 10 ferramentas, tais como: Tesoura de corte, alicates, chave combinada dentre outras.";
  const texto54 = "Imagem 5 ‚Äì Inspe√ß√£o das ferramentas utilizadas no AL-13.";
  const texto55 = "5.4 ‚Äì A inspe√ß√£o das ferramentas √© realizada por equipe multidisciplinar formada por representantes do SOP/ARM e SMS. Nela, os usu√°rios das ferramentas foram convidados a participar, objetivando desenvolver ainda mais a percep√ß√£o de seguran√ßa quanto √† utiliza√ß√£o das ferramentas.";

  const paragrafos13 = [texto51, texto52, texto53, texto54, texto55];
  paragrafos13.forEach(p => {
    const linhas = doc.splitTextToSize(p, width - margin * 2);
    doc.text(linhas, margin, y);
    y += linhas.length * 14 + 10;
  });

  y += 20;
}

// Texto espec√≠fico do Dep√≥sito 24
if (deposito === "Dep√≥sito 24") {
  doc.setFont("helvetica", "bold");
  doc.setFontSize(14);
  doc.text("6. Inspe√ß√£o de Ferramentas Dep√≥sito D-24", margin, y);
  y += 25;

  doc.setFont("helvetica", "normal");
  doc.setFontSize(11);

  const texto61 = "6.1 ‚Äì O AL-24 do SOP/ARM √© uma √°rea destinada a execu√ß√£o de servi√ßos de confec√ß√£o de embalagens para transporte de materiais, constru√ß√£o e/ou reparo em pallets, dentre outros servi√ßos que tenham a madeira como mat√©ria-prima.";
  const texto62 = "6.2 ‚Äì Nesta √°rea, as atividades citadas no item 6.1 deste relat√≥rio de inspe√ß√£o s√£o realizadas por 05 colaboradores. Os profissionais est√£o aptos a manusear as ferramentas utilizadas na execu√ß√£o dos servi√ßos e respons√°veis pela limpeza, conserva√ß√£o e verifica√ß√£o di√°ria da condi√ß√£o das ferramentas.";
  const texto63 = "6.3 ‚Äì Atualmente no AL-24 possui 05 ferramentas, tais como: P√© de cabra, corta cabo, alicate, escova de a√ßo dentre outras.";
  const texto64 = "Imagem 8 ‚Äì Inspe√ß√£o das ferramentas utilizadas no AL-24.";
  const texto65 = "6.4 ‚Äì A inspe√ß√£o das ferramentas √© realizada por equipe multidisciplinar formada por representantes do SOP/ARM e SMS. Nela, os usu√°rios das ferramentas foram convidados a participar, objetivando desenvolver ainda mais a percep√ß√£o de seguran√ßa quanto a utiliza√ß√£o das ferramentas.";

  const paragrafos24 = [texto61, texto62, texto63, texto64, texto65];
  paragrafos24.forEach(p => {
    const linhas = doc.splitTextToSize(p, width - margin * 2);
    doc.text(linhas, margin, y);
    y += linhas.length * 14 + 10;
  });

  y += 20; // espa√ßamento antes da lista de ferramentas
}





// Texto espec√≠fico do Dep√≥sito 25
if (deposito === "Dep√≥sito 25") {
  doc.setFont("helvetica", "bold");
  doc.setFontSize(14);
  doc.text("8. Inspe√ß√£o de Ferramentas Dep√≥sito D-25", margin, y);
  y += 25;

  doc.setFont("helvetica", "normal");
  doc.setFontSize(11);

  const texto81 = "8.1 ‚Äì O Dep√≥sito 25 do SOP/ARM √© uma √°rea destinada para recebimento, confer√™ncia f√≠sica e o processamento da entrada de mercadorias no SAP, para o atendimento as necessidades dos clientes no √¢mbito da UN-BA.";
  const texto82 = "8.2 ‚Äì Nesta √°rea, as atividades citadas no item 8.1 deste relat√≥rio de inspe√ß√£o s√£o realizadas por 6 colaboradores. Os profissionais est√£o aptos a manusear as ferramentas utilizadas na execu√ß√£o dos servi√ßos e respons√°veis pela limpeza, conserva√ß√£o e verifica√ß√£o di√°ria da condi√ß√£o das ferramentas.";
  const texto83 = "8.3 ‚Äì Atualmente o dep√≥sito AL-25 possui 60 ferramentas, tais como: martelos, estiletes, p√© de cabra, dentre outras.";
  const texto84 = "Imagem 10 ‚Äì Inspe√ß√£o das ferramentas utilizadas no AL-25.";
  const texto85 = "8.4 ‚Äì A inspe√ß√£o das ferramentas √© realizada por equipe multidisciplinar formada por representantes do SOP/ARM e SMS. Nela, os usu√°rios das ferramentas foram convidados a participar, objetivando desenvolver ainda mais a percep√ß√£o de seguran√ßa quanto a utiliza√ß√£o das ferramentas.";

  const paragrafos25 = [texto81, texto82, texto83, texto84, texto85];
  paragrafos25.forEach(p => {
    const linhas = doc.splitTextToSize(p, width - margin * 2);
    doc.text(linhas, margin, y);
    y += linhas.length * 14 + 10;
  });

  y += 20; // espa√ßamento antes da lista de ferramentas
}




    // Itens
    const itens = itemsByDeposit[deposito];
    for(let i=0;i<itens.length;i++){
      const nome = itens[i];
      const desc = itemDescriptions[nome] || "‚Äî";

      if(y>700){doc.addPage(); y=60;}
      const boxHeightItem=22, textWidthItem = doc.getTextWidth(nome)+20;
      const boxWidthItem = Math.min(textWidthItem,width-margin*2);
      doc.setFillColor(46,184,114); doc.roundedRect(margin-2,y-14,boxWidthItem,boxHeightItem,5,5,"F");
      doc.setTextColor(255,255,255); doc.text(nome,margin+5,y+2); doc.setTextColor(0,0,0); y+=20;





      // ==================== IN√çCIO DA ALTERA√á√ÉO ====================
doc.setTextColor(0, 0, 0);
doc.setFontSize(10);



// Divide o texto em frases ou quebras de linha
const descLines = desc.split(/\.\s*|\n/).map(l => l.trim()).filter(l => l);

descLines.forEach(line => {
  if(line) {
    const splitLine = doc.splitTextToSize(`‚Ä¢ ${line}${line.endsWith('.') ? '' : '.'}`, width - margin*2 - 10);
    splitLine.forEach(part => {
      doc.text(part, margin + 10, y); // indenta√ß√£o
      y += 14;
    });
  }
});

y += 6; // espa√ßo extra ap√≥s descri√ß√£o





     // Pega os valores selecionados e observa√ß√µes
const radios = document.getElementsByName(`chk_${i}`);
let status = "‚Äî";
radios.forEach(r => { if (r.checked) status = r.value; });

const obsInput = itemsContainer.querySelectorAll("input[type=text]")[i];
const observacao = obsInput ? obsInput.value || "‚Äî" : "‚Äî";

// Adiciona ao PDF
doc.text(`Status: ${status}`, margin, y);
y += 12;
doc.text(`Observa√ß√£o: ${observacao}`, margin, y);
y += 10;


      // Fotos
      const fotos = (photosData[deposito] && photosData[deposito][i]) || [];
let x = margin;
const fotoTam = 250;
let linhaFotoTam = 0;

for (let p = 0; p < fotos.length; p++) {
  if (fotos[p]) {
    const img = await new Promise(res => {
      const im = new Image();
      im.onload = () => res(im);
      im.src = fotos[p];
    });
    if (x + fotoTam > width - margin) {
      x = margin;
      y += linhaFotoTam + 10;
      linhaFotoTam = 0;
    }
    doc.addImage(img, "PNG", x, y, fotoTam, fotoTam);
    linhaFotoTam = fotoTam;
    x += fotoTam + 10;
  }
}

// Sempre adiciona um espa√ßamento extra, mesmo sem fotos
y += (linhaFotoTam > 0 ? linhaFotoTam + 45 : 45);


    }
    // Antes de adicionar a √∫ltima p√°gina
if (y + 200 > doc.internal.pageSize.getHeight()) {
  doc.addPage();
  y = 60;
}

  }

  // === √öLTIMA P√ÅGINA: Representantes e Usu√°rios ===
doc.addPage();

// Adicionar t√≠tulo "Assinaturas" no topo centralizado
doc.setFont("helvetica", "bold");
doc.setFontSize(14);
doc.text("Assinatura e Matr√≠cula", width / 2, 40, { align: "center" });  // Centralizado no topo (y=40 para dar espa√ßo do topo da p√°gina)
y = 60;  // Continua com y=60 para o resto do conte√∫do

doc.setFont("helvetica","normal");
doc.setFontSize(12);

const representantes = [
  "________________________________________________________________                  \n    Representante do SOP/ARM \nUN-BA/SOP/ARM",
  "________________________________________________________________                  \n    Representante do SOP/ARM \nUN-BA/SOP/ARM",
  "________________________________________________________________                  \n    Representante do SMS\nUN-BA/SMS",
  "________________________________________________________________                  \n    Usu√°rio da Ferramenta Inspecionada\nUN-BA/SOP/ARM",
  "________________________________________________________________                  \n    Usu√°rio da Ferramenta Inspecionada\nUN-BA/SOP/ARM"
];

representantes.forEach(text => {
  const lines = doc.splitTextToSize(text, width - 80); // margem de 40 de cada lado
  doc.text(lines, 40, y);
  y += lines.length * 18 + 20; // espa√ßamento entre blocos
});



  doc.save(`Checklist_todos_depositos_${dataHora.replace(/[\/\s:]/g,"_")}.pdf`);


});
</script>
</body>
</html>
