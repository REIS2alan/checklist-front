<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Checklist de Inspe√ß√£o de Ferramentas ‚Äì Dep√≥sito</title>
<style>
:root {
  --bg: #121417;
  --card: #1c1f23;
  --accent: #2eb872;
  --muted: #a0a8b3;
  --border: #2a2f34;
  --text: #e9edf1;
  --input-bg: #fff;
}

body {
  margin: 0;
  padding: 12px;
  font-family: "Segoe UI", Arial, sans-serif;
  background: var(--bg);
  color: var(--text);
}

.container {
  max-width: 1000px;
  margin: auto;
}

header {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  align-items: center;
  gap: 10px;
}

h1 {
  font-size: 22px;
  margin: 0;
}

.card {
  background: var(--card);
  border-radius: 14px;
  padding: 20px;
  margin-top: 16px;
  box-shadow: 0 6px 14px rgba(0, 0, 0, 0.3);
  border: 1px solid var(--border);
}

.row {
  display: flex;
  flex-wrap: wrap;
  gap: 12px;
}

.row > div {
  flex: 1;
  min-width: 220px;
}

label {
  display: block;
  font-size: 13px;
  color: var(--muted);
  margin-bottom: 4px;
  font-weight: 500;
}

input[type=text],
select,
textarea {
  width: 100%;
  padding: 8px;
  border-radius: 8px;
  border: 1px solid var(--border);
  font-size: 14px;
  background: var(--input-bg);
  color: #1e293b;
}

textarea {
  resize: vertical;
}

.items {
  margin-top: 16px;
}

.item {
  background: #1f2327;
  border-radius: 10px;
  padding: 12px;
  border: 1px solid var(--border);
  margin-bottom: 12px;
  transition: background 0.2s;
}

.item:hover {
  background: #24282d;
}

.item h3 {
  margin: 0 0 4px;
  font-size: 15px;
  color: var(--text);
}

.photos {
  display: flex;
  gap: 6px;
  margin-top: 4px;
}

.photos img {
  width: 65px;
  height: 65px;
  border-radius: 8px;
  object-fit: cover;
  border: 1px solid var(--border);
}

.btn {
  display: inline-block;
  padding: 8px 16px;
  border-radius: 8px;
  border: none;
  cursor: pointer;
  font-weight: 600;
  font-size: 14px;
  transition: background 0.2s, transform 0.1s;
}

.btn:hover {
  transform: translateY(-1px);
}

.btn.primary {
  background: var(--accent);
  color: #fff;
}

.btn.primary:hover {
  background: #239e61;
}

.btn.ghost {
  background: transparent;
  border: 1px solid var(--accent);
  color: var(--accent);
}

.btn.ghost:hover {
  background: rgba(46, 184, 114, 0.1);
}

footer {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  justify-content: flex-end;
  margin-top: 20px;
}

.signature-area {
  margin-top: 20px;
  background: #1a1d21;
  border: 1px solid var(--border);
  border-radius: 10px;
  padding: 10px;
}

.signature-box {
  width: 30%;
  height: 80px;
  border: 2px dashed #555;
  border-radius: 2px;
  background: #fff;
  touch-action: none;
}

@media (max-width: 600px) {
  .btn {
    width: 100%;
    text-align: center;
  }
}

</style>
</head>
<body>
<div class="container">
<header>
  <h1>Checklist de Inspe√ß√£o de Ferramentas</h1>
</header>
<div class="card">
  <div class="row">
    <div><label>Dep√≥sito</label>
      <select id="deposit"><option value="">Selecione um dep√≥sito</option></select>
    </div>
  </div>

  <div class="items" id="itemsContainer"></div>
  <p id="emptyNote" style="display:none;color:#777;text-align:center;">Nenhuma ferramenta para este dep√≥sito.</p>

  <div class="row" style="margin-top:12px;">
    <div><label>Observa√ß√£o Geral</label><textarea id="generalObs" rows="2"></textarea></div>
  </div>

  <div class="signature-area">
    <label>Assinatura Respons√°vel pelas Ferramentas:</label>
    <canvas id="sig_resp" class="signature-box"></canvas>
  </div>
  <div class="signature-area">
    <label>Assinatura SMS:</label>
    <canvas id="sig_sms" class="signature-box"></canvas>
  </div>
  <div class="signature-area">
    <label>Equipe Auditoria:</label>
    <canvas id="sig_supervisor" class="signature-box"></canvas>
  </div>

  <footer>
    <button class="btn primary" id="reportBtn">Gerar PDF</button>
  </footer>
</div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>
const { jsPDF } = window.jspdf;

// Textos explicativos aprimorados
const itemDescriptions = {
  "Tesoura": "Verificar se as l√¢minas est√£o afiadas, alinhadas, limpas e livres de ferrugem. Checar se o cabo est√° firme e confort√°vel ao uso.",
  "Tesoura de Corte": "Inspecionar o alinhamento e a afia√ß√£o das l√¢minas, aus√™ncia de oxida√ß√£o, firmeza do cabo e funcionamento suave ao abrir e fechar.",
  "Trena": "Inspecionar a fixa√ß√£o da cabe√ßa, aus√™ncia de folgas, rachaduras ou oxida√ß√£o. Checar se o cabo est√° √≠ntegro e bem fixado.",
  "Escova de A√ßo": "Checar se as cerdas est√£o firmes, sem desgaste excessivo ou deforma√ß√µes, e se o cabo est√° em bom estado e firme.",
  "Martelo": "Inspecionar a fixa√ß√£o da cabe√ßa, aus√™ncia de folgas, rachaduras ou oxida√ß√£o. Checar se o cabo est√° √≠ntegro e bem fixado.",
  "Estilete": "Verificar se a l√¢mina est√° afiada e firme no suporte, funcionamento da trava, e se o corpo do estilete n√£o possui trincas.",
  "Kit Cinta Arqueamento": "Conferir se todas as pe√ßas do kit est√£o presentes, limpas e funcionais, com mecanismo de arqueamento operando corretamente.",
  "Chave Combinada": "Inspecionar se n√£o h√° desgaste nas bocas, deforma√ß√µes ou oxida√ß√£o. Verificar se a ferramenta est√° limpa e em bom estado.",
  "Alicate Universal": "Verificar o alinhamento das mand√≠bulas, movimento suave sem folgas, e integridade dos cabos isolantes.",
  "Chave de Fenda": "Checar se a ponta est√° √≠ntegra, sem desgaste ou deforma√ß√£o, e se o cabo est√° firme e sem rachaduras.",
  "P√©-de-Cabra Torcido": "Inspecionar se n√£o h√° trincas, empenamentos ou deforma√ß√µes. Verificar se a superf√≠cie est√° limpa e sem corros√£o.",
  "Marreta": "Verificar se a cabe√ßa est√° firme e sem folgas, cabo √≠ntegro e sem rachaduras, e aus√™ncia de oxida√ß√£o nas partes met√°licas.",
  "Ferramento": "Avaliar o estado geral da ferramenta, funcionamento adequado, limpeza e aus√™ncia de danos estruturais.",
  "Hands Off": "Checar se o equipamento est√° limpo, sem rachaduras ou deforma√ß√µes, e se os mecanismos est√£o operando corretamente.",
  "Alicate Corta Cabo": "Verificar o corte eficiente sem deformar o cabo, alinhamento das l√¢minas e integridade do isolamento.",
  "Grampeador": "Testar o funcionamento suave, verificar se n√£o emperra e se realiza grampeamento completo e firme.",
  "Torque Armador 12": "Conferir a calibra√ß√£o do torque, aus√™ncia de folgas, funcionamento preciso e integridade estrutural.",
  "Esquadro 10 para Carpinteiro": "Verificar se mant√©m √¢ngulos precisos de 90¬∞, sem empeno, rachaduras ou sujeira excessiva.",
  "L√°pis Carpinteiro": "Checar se escreve corretamente, ponta afiada e corpo sem quebras ou rachaduras.",
  "Form√£o para Madeira": "Verificar se a l√¢mina est√° afiada, limpa e bem fixada ao cabo, sem oxida√ß√£o ou folgas.",
  "Kit de Chave Combinada": "Confirmar se o conjunto est√° completo, limpo, sem deforma√ß√µes e armazenado adequadamente.",
  "Serra Tico e Teco": "Inspecionar se a l√¢mina est√° firme, afiada e sem desgaste, e se o motor e acionamento funcionam corretamente.",
  "Jogo de Brocas e Soquetes": "Verificar se o kit est√° completo, organizado, sem desgaste nas pontas e com encaixes firmes.",
  "Parafusadeira El√©trica": "Testar o funcionamento, rota√ß√£o e torque, conferir integridade da carca√ßa e n√≠vel de carga da bateria.",
  "L√¢mina de Serra Tico-Teco": "Verificar se est√° afiada, limpa, sem empenamento ou trincas e pronta para uso seguro."
};


// Itens por dep√≥sito
const itemsByDeposit = {
  "Dep√≥sito 6":["Kit Cinta Arqueamento"],
  "Dep√≥sito 9":["Trena","Escova de A√ßo","Martelo","Estilete","Tesoura","Kit Cinta Arqueamento"],
  "Dep√≥sito 13":["Tesoura de Corte","Chave Combinada","Trena","Alicate Universal","Chave de Fenda","Martelo","Estilete","P√©-de-Cabra Torcido","Marreta","Ferramento","Hands Off"],
  "Dep√≥sito 24":["Trena","P√© de Cabra Torcido","Tesoura de Corte","Alicate Corta Cabo","Martelo","Escova de A√ßo","Chave de Fenda","Kit Cinta Arqueamento"],
  "Dep√≥sito 25":["Chave de Fenda","Alicate Universal","Martelo","Estilete","P√© de Cabra Torcido","Trena","Kit Cinta Arqueamento","Grampeador"],
  "Carpintaria":["Chave de Fenda","Alicate Universal","Martelo","Estilete","Trena","Torque Armador 12","Esquadro 10 para Carpinteiro","L√°pis Carpinteiro","Form√£o para Madeira","Kit de Chave Combinada","Serra Tico e Teco","Jogo de Brocas e Soquetes","Parafusadeira El√©trica","L√¢mina de Serra Tico-Teco"]
};

// Preenche dep√≥sitos
const depositSelect=document.getElementById('deposit');
Object.keys(itemsByDeposit).forEach(dep=>{
  const opt=document.createElement('option'); opt.value=dep; opt.textContent=dep; depositSelect.appendChild(opt);
});

// Criar itens e fotos
const itemsContainer=document.getElementById('itemsContainer');
const emptyNote=document.getElementById('emptyNote');
let photosData = {};

depositSelect.addEventListener("change", () => {
  const deposit = depositSelect.value;
  const itemsContainer = document.getElementById("itemsContainer");
  itemsContainer.innerHTML = "";

  if (!deposit || !itemsByDeposit[deposit]) return;

  const list = itemsByDeposit[deposit];
  photosData[deposit] = [];

  list.forEach((item, i) => {
    const div = document.createElement("div");
    div.className = "item";
    const descricao = itemDescriptions[item] || "";

    div.innerHTML = `
      <h3>${i + 1}. ${item}</h3>
      <div style="font-size:13px; color:#bbb; margin-bottom:8px; text-align:left;">
        ${descricao}
      </div>
      <label><input type="radio" name="chk_${i}" value="Aprovada"> Aprovada</label>
      <label><input type="radio" name="chk_${i}" value="Reprovada"> Reprovada</label>
      <input type="text" placeholder="Observa√ß√£o">
     <div class="photos" id="photos_${i}">
  <!-- Bot√£o 1: C√¢mera -->
  <label class="btn ghost" style="padding:4px 8px;font-size:12px;">üì∑ Abrir C√¢mera
    <input type="file" accept="image/*" capture="environment" style="display:none"
           onchange="previewPhoto(event,'${deposit}',${i},0)">
  </label>

  <!-- Bot√£o 2: Galeria -->
  <label class="btn ghost" style="padding:4px 8px;font-size:12px;">üñºÔ∏è Selecionar da Galeria
    <input type="file" accept="image/*" style="display:none"
           onchange="previewPhoto(event,'${deposit}',${i},0)">
  </label>
</div>

    `;

    itemsContainer.appendChild(div);
    photosData[deposit][i] = [];
  });
});



window.previewPhoto = function(e, deposito, index, photoIndex){
  const cont = document.getElementById(`photos_${index}`);
  const file = e.target.files[0]; if(!file) return;
  const reader = new FileReader();
  reader.onload = function(ev){
    photosData[deposito][index][photoIndex] = ev.target.result;
    const img = document.createElement('img'); img.src = ev.target.result; cont.appendChild(img);
  }
  reader.readAsDataURL(file);
};

// Assinatura
function enableDraw(c){
  const ctx=c.getContext("2d");
  ctx.strokeStyle="#000"; ctx.lineWidth=2; ctx.lineCap="round";
  const resize=()=>{const ratio=window.devicePixelRatio||1;const rect=c.getBoundingClientRect();c.width=rect.width*ratio;c.height=rect.height*ratio;ctx.setTransform(ratio,0,0,ratio,0,0);}
  resize(); window.addEventListener("resize",resize);
  let drawing=false;
  function pos(e){const r=c.getBoundingClientRect();const t=e.touches?e.touches[0]:e;return{x:t.clientX-r.left,y:t.clientY-r.top};}
  c.addEventListener("mousedown",e=>{drawing=true;const p=pos(e);ctx.beginPath();ctx.moveTo(p.x,p.y);});
  c.addEventListener("mousemove",e=>{if(!drawing)return;const p=pos(e);ctx.lineTo(p.x,p.y);ctx.stroke();});
  c.addEventListener("mouseup",()=>drawing=false); c.addEventListener("mouseleave",()=>drawing=false);
  c.addEventListener("touchstart",e=>{drawing=true;const p=pos(e);ctx.beginPath();ctx.moveTo(p.x,p.y);},{passive:false});
  c.addEventListener("touchmove",e=>{if(!drawing)return;const p=pos(e);ctx.lineTo(p.x,p.y);ctx.stroke();},{passive:false});
  c.addEventListener("touchend",()=>drawing=false);
}
const canvases=[{id:'sig_resp',label:'Respons√°vel pelas Ferramentas'},{id:'sig_sms',label:'SMS'},{id:'sig_supervisor',label:'Equipe Auditoria'}];
canvases.forEach(c=>enableDraw(document.getElementById(c.id)));

// Gerar PDF
document.getElementById("reportBtn").addEventListener("click", async () => {
  const doc = new jsPDF("p","pt","a4");
  const width = doc.internal.pageSize.getWidth();
  const margin = 40;
  let y = 60;
  const dataHora = new Date().toLocaleString("pt-BR");
  const depositos = Object.keys(itemsByDeposit);
  const obs = document.getElementById("generalObs").value || "‚Äî";

  for(let d=0; d<depositos.length; d++){
    const deposito = depositos[d];
    // Cabe√ßalho
    const boxHeight = 22, gap = 10;
    const infos = [["Data/Hora", dataHora],["Dep√≥sito", deposito]];
    const totalWidth = width - margin*2 - gap*(infos.length-1);
    const boxWidth = totalWidth/infos.length;
    infos.forEach((info,i)=>{
      const x=margin + i*(boxWidth+gap);
      doc.setFillColor(46,184,114); doc.roundedRect(x, y-16, boxWidth, boxHeight,5,5,"F");
      doc.setTextColor(255,255,255); doc.setFont("helvetica","bold"); doc.setFontSize(10);
      const text=`${info[0]}: ${info[1]}`;
      const textX = x + (boxWidth-doc.getTextWidth(text))/2;
      doc.text(text,textX,y);
      doc.setTextColor(0,0,0);
    });
    y += boxHeight + 20;
    doc.setFont("helvetica","bold"); doc.setFontSize(12); doc.text("Observa√ß√£o Geral:",margin,y); y+=15;
    doc.setFont("helvetica","normal"); const lines=doc.splitTextToSize(obs,width-margin*2); doc.text(lines,margin,y); y+=lines.length*12+20;

    // Itens
    const itens = itemsByDeposit[deposito];
    for(let i=0;i<itens.length;i++){
      const nome = itens[i];
      const desc = itemDescriptions[nome] || "‚Äî";

      if(y>700){doc.addPage(); y=60;}
      const boxHeightItem=22, textWidthItem = doc.getTextWidth(nome)+20;
      const boxWidthItem = Math.min(textWidthItem,width-margin*2);
      doc.setFillColor(46,184,114); doc.roundedRect(margin-2,y-14,boxWidthItem,boxHeightItem,5,5,"F");
      doc.setTextColor(255,255,255); doc.text(nome,margin+5,y+2); doc.setTextColor(0,0,0); y+=20;

      // ==================== IN√çCIO DA ALTERA√á√ÉO ====================
doc.setTextColor(0, 0, 0);
doc.setFontSize(10);

// Divide o texto em frases separadas por ponto ou quebra de linha
const descLines = desc.split(/\.\s*|\n/).map(l => l.trim()).filter(l => l);

descLines.forEach(line => {
  if(line) {
    // Adiciona marcador e indenta√ß√£o (margin + 10)
    doc.text(`‚Ä¢ ${line}${line.endsWith('.') ? '' : '.'}`, margin + 10, y);
    y += 14; // espa√ßamento entre linhas
  }
});

y += 6; // espa√ßo extra ap√≥s a descri√ß√£o
// ==================== FIM DA ALTERA√á√ÉO ====================




     // Pega os valores selecionados e observa√ß√µes
const radios = document.getElementsByName(`chk_${i}`);
let status = "‚Äî";
radios.forEach(r => { if (r.checked) status = r.value; });

const obsInput = itemsContainer.querySelectorAll("input[type=text]")[i];
const observacao = obsInput ? obsInput.value || "‚Äî" : "‚Äî";

// Adiciona ao PDF
doc.text(`Status: ${status}`, margin, y);
y += 12;
doc.text(`Observa√ß√£o: ${observacao}`, margin, y);
y += 10;


      // Fotos
      const fotos = (photosData[deposito] && photosData[deposito][i]) || [];
      let x=margin; const fotoTam=250; let linhaFotoTam=0;
      for(let p=0;p<fotos.length;p++){
        if(fotos[p]){
          const img=await new Promise(res=>{
            const im=new Image();
            im.onload=()=>res(im);
            im.src=fotos[p];
          });
          if(x + fotoTam > width - margin){ x=margin; y+=linhaFotoTam+10; linhaFotoTam=0; }
          doc.addImage(img,"PNG",x,y,fotoTam,fotoTam);
          linhaFotoTam = fotoTam;
          x += fotoTam + 10;
        }
      }
      if(fotos.length>0) y+=linhaFotoTam+20;
    }
    if(d<depositos.length-1){doc.addPage(); y=60;}
  }

  // Assinaturas
  doc.addPage(); y=60; doc.setFont("helvetica","bold"); doc.setFontSize(14);
  doc.text("Assinaturas",width/2,y,{align:"center"}); y+=30;
  const sigW=200,sigH=80;
  for(const cObj of canvases){
    const canvas=document.getElementById(cObj.id);
    const dataURL=canvas.toDataURL("image/png",1.0);
    doc.setFont("helvetica","normal"); doc.text(cObj.label+":",margin,y);
    doc.addImage(dataURL,"PNG",margin+120,y-15,sigW,sigH);
    y+=sigH+40;
  }

  doc.save(`Checklist_todos_depositos_${dataHora.replace(/[\/\s:]/g,"_")}.pdf`);
});
</script>
</body>
</html>
